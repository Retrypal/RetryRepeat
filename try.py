# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'untitled.ui'
#
# Created by: PyQt5 UI code generator 5.15.11
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt5 import QtCore, QtGui, QtWidgets
import mouse, keyboard, pickle,os
class Ui_MainWindow(object):
    def setupUi(self, MainWindow):
        MainWindow.setObjectName("MainWindow")
        MainWindow.setWindowModality(QtCore.Qt.NonModal)
        MainWindow.setEnabled(True)
        MainWindow.resize(413, 120)
        MainWindow.setMinimumSize(QtCore.QSize(413, 120))
        MainWindow.setMaximumSize(QtCore.QSize(413, 120))
        MainWindow.setSizeIncrement(QtCore.QSize(0, 0))
        MainWindow.setBaseSize(QtCore.QSize(412, 150))
        MainWindow.setToolTipDuration(0)
        MainWindow.setAnimated(True)
        self.events=[]
        self.centralwidget = QtWidgets.QWidget(MainWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.horizontalLayoutWidget = QtWidgets.QWidget(self.centralwidget)
        self.horizontalLayoutWidget.setGeometry(QtCore.QRect(0, 90, 411, 31))
        self.horizontalLayoutWidget.setObjectName("horizontalLayoutWidget")
        self.horizontalLayout = QtWidgets.QHBoxLayout(self.horizontalLayoutWidget)
        self.horizontalLayout.setSizeConstraint(QtWidgets.QLayout.SetNoConstraint)
        self.horizontalLayout.setContentsMargins(0, 0, 0, 0)
        self.horizontalLayout.setObjectName("horizontalLayout")
        self.pushButton_2 = QtWidgets.QPushButton(self.horizontalLayoutWidget)
        self.pushButton_2.setEnabled(True)
        self.pushButton_2.setMaximumSize(QtCore.QSize(16777215, 23))
        self.pushButton_2.setLayoutDirection(QtCore.Qt.LeftToRight)
        self.pushButton_2.setAutoFillBackground(False)
        self.pushButton_2.setObjectName("pushButton_2")
        self.pushButton_2.clicked.connect(self.play)
        self.horizontalLayout.addWidget(self.pushButton_2)
        self.pushButton_3 = QtWidgets.QPushButton(self.horizontalLayoutWidget)
        self.pushButton_3.setAutoDefault(False)
        self.pushButton_3.setDefault(False)
        self.pushButton_3.setFlat(False)
        self.pushButton_3.setObjectName("pushButton_3")
        self.horizontalLayout.addWidget(self.pushButton_3)
        self.pushButton = QtWidgets.QPushButton(self.horizontalLayoutWidget)
        self.pushButton.setObjectName("pushButton")
        self.horizontalLayout.addWidget(self.pushButton, 0, QtCore.Qt.AlignVCenter)
        self.label = QtWidgets.QLabel(self.centralwidget)
        self.label.setGeometry(QtCore.QRect(10, 10, 241, 71))
        self.label.setText("")
        self.label.setAlignment(QtCore.Qt.AlignCenter)
        self.label.setObjectName("label")
        self.verticalLayoutWidget = QtWidgets.QWidget(self.centralwidget)
        self.verticalLayoutWidget.setGeometry(QtCore.QRect(250, 10, 160, 80))
        self.verticalLayoutWidget.setObjectName("verticalLayoutWidget")
        self.verticalLayout = QtWidgets.QVBoxLayout(self.verticalLayoutWidget)
        self.verticalLayout.setContentsMargins(0, 0, 0, 0)
        self.verticalLayout.setObjectName("verticalLayout")
        self.pushButton_4 = QtWidgets.QPushButton(self.verticalLayoutWidget)
        self.pushButton_4.setObjectName("pushButton_4")
        self.pushButton.clicked.connect(self.chose_file)
        self.verticalLayout.addWidget(self.pushButton_4)
        self.pushButton_5 = QtWidgets.QPushButton(self.verticalLayoutWidget)
        self.pushButton_5.setObjectName("pushButton_5")
        self.pushButton_3.clicked.connect(self.record)
        self.verticalLayout.addWidget(self.pushButton_5)
        MainWindow.setCentralWidget(self.centralwidget)

        self.retranslateUi(MainWindow)
        #QtCore.QMetaObject.connectSlotsByName(MainWindow)

    def retranslateUi(self, MainWindow):
        _translate = QtCore.QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "MainWindow"))
        self.pushButton_2.setText(_translate("MainWindow", "‚ñ∫"))
        self.pushButton_3.setText(_translate("MainWindow", "üî¥, –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–ø–∏—Å–∏ F9"))
        self.pushButton.setText(_translate("MainWindow", "üìÅ"))
        self.pushButton_4.setText(_translate("MainWindow", "–ü–æ–¥–¥–µ—Ä–∂–∫–∞"))
        self.pushButton_5.setText(_translate("MainWindow", "–í–∏–¥–µ–æ-–≥–∞–π–¥ –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"))
    def record(self):
        self.events=[]
        mouse.hook(self.events.append)
        keyboard.wait('F9')
        mouse.unhook(self.events.append)
        text, ok =QtWidgets.QInputDialog.getText(MainWindow,'–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞','–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∑–∞–ø–∏—Å–∏')
        if ok:
            with open (f'{text}.pkl','wb') as file:
                pickle.dump(self.events,file)
            self.label.setText(f'–í—ã–±—Ä–∞–Ω —à–∞–±–ª–æ–Ω {text}')
        else:
            self.label.setText('–®–∞–±–ª–æ–Ω –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω')
    def chose_file(self):
        name=QtWidgets.QFileDialog.getOpenFileName(MainWindow,'–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø–∏—Å—å —Å —Ñ–æ—Ä–º–∞—Ç–æ–º pkl',os.path.dirname(__file__))
        name=name[0]
        if name=='':
            return
        path=name
        name=(name[name.rfind('/')+1:])
        self.label.setText(f'–í—ã–±—Ä–∞–Ω —à–∞–±–ª–æ–Ω {name}')
        with open(path,'rb') as file:
            self.events=pickle.load(file)
        
    def play(self):
        sss=0
        de=[]
        for i in self.events:
            de.append(i)
            sss+=1
            if sss%3==0:    
                if not keyboard.is_pressed('F9'):
                    mouse.play(de)
                    de=[]
                else:
                    break
        


        
        

if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    MainWindow = QtWidgets.QMainWindow()
    ui = Ui_MainWindow()
    ui.setupUi(MainWindow)
    MainWindow.show()
    sys.exit(app.exec_())
